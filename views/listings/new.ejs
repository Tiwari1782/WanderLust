<% layout("/layouts/boilerplate") %>

<div class="row">
  <div class="col-10 offset-1 col-lg-8 offset-lg-2">
    <div class="form-page-container">
      <!-- Header -->
      <div class="form-page-header">
        <div class="form-page-icon">
          <i class="fa-solid fa-circle-plus"></i>
        </div>
        <h1 class="form-page-title">Create a New Listing</h1>
      </div>

      <!-- Form -->
      <form
        action="/listings"
        method="POST"
        novalidate
        class="needs-validation"
        enctype="multipart/form-data"
      >
        <!-- Title -->
        <div class="form-input-group">
          <label for="title" class="form-input-label">
            <i class="fa-solid fa-heading"></i>
            Title
          </label>
          <input
            class="form-control form-input"
            type="text"
            name="listing[title]"
            placeholder="Add a catchy title"
            required
          />
          <div class="invalid-feedback">Please enter a title</div>
          <div class="valid-feedback">Title looks good!</div>
        </div>

        <!-- Description -->
        <div class="form-input-group">
          <label for="description" class="form-input-label">
            <i class="fa-solid fa-align-left"></i>
            Description
          </label>
          <textarea
            class="form-control form-textarea"
            name="listing[description]"
            placeholder="Describe your listing in detail..."
            required
          ></textarea>
          <div class="invalid-feedback">Please enter a description</div>
          <div class="valid-feedback">Description looks good!</div>
        </div>

        <!-- Image Upload -->
<div class="form-input-group">
  <label for="image" class="form-input-label">
    <i class="fa-solid fa-image"></i>
    Upload Image
  </label>
  
  <!-- Cloud Upload Area -->
  <div class="cloud-upload-container" id="cloudUpload">
    <input
      class="cloud-upload-input"
      type="file"
      name="listing[image]"
      id="fileInput"
      accept="image/png, image/jpeg, image/jpg"
    />
    
    <div class="cloud-upload-content">
      <div class="cloud-icon-wrapper">
        <i class="fa-solid fa-cloud-arrow-up cloud-icon"></i>
      </div>
      
      <h3 class="cloud-upload-title">Drop your image here, or <span class="browse-text">browse</span></h3>
      <p class="cloud-upload-subtitle">Supports: PNG, JPG, JPEG (Max 5MB)</p>
      
      <div class="upload-button-wrapper">
        <button type="button" class="btn-upload-trigger" onclick="document.getElementById('fileInput').click()">
          <i class="fa-solid fa-folder-open"></i>
          Choose File
        </button>
      </div>
    </div>
    
    <!-- File Preview -->
    <div class="file-preview" id="filePreview" style="display: none;">
      <div class="preview-image-wrapper">
        <img src="" alt="Preview" id="previewImage" class="preview-image">
        <button type="button" class="btn-remove-file" onclick="removeFile()">
          <i class="fa-solid fa-xmark"></i>
        </button>
      </div>
      <div class="file-info">
        <p class="file-name" id="fileName"></p>
        <p class="file-size" id="fileSize"></p>
      </div>
    </div>
  </div>
  
  <div class="form-helper-text">
    <i class="fa-solid fa-circle-info"></i>
    Upload a high-quality image for better visibility
  </div>
  <div class="invalid-feedback">Please upload a valid PNG, JPG, or JPEG file</div>
  <div class="valid-feedback">Image looks good!</div>
</div>

        <!-- Price & Country Row -->
        <div class="form-row-custom">
          <!-- Price -->
          <div class="form-input-group">
            <label for="price" class="form-input-label">
              <i class="fa-solid fa-indian-rupee-sign"></i>
              Price
            </label>
            <div class="price-input-wrapper">
              <input
                class="form-control form-input"
                name="listing[price]"
                type="number"
                placeholder="1200"
                required
              />
            </div>
            <div class="invalid-feedback">Please enter a valid price</div>
            <div class="valid-feedback">Price looks good!</div>
          </div>

          <!-- Country -->
          <div class="form-input-group">
            <label for="country" class="form-input-label">
              <i class="fa-solid fa-earth-americas"></i>
              Country
            </label>
            <input
              class="form-control form-input"
              name="listing[country]"
              placeholder="e.g., India"
              type="text"
              required
            />
            <div class="invalid-feedback">Please enter a country</div>
            <div class="valid-feedback">Country looks good!</div>
          </div>
        </div>

        <!-- Location -->
        <div class="form-input-group">
          <label for="location" class="form-input-label">
            <i class="fa-solid fa-location-dot"></i>
            Location
          </label>
          <input
            class="form-control form-input"
            name="listing[location]"
            placeholder="e.g., Mumbai, Maharashtra"
            type="text"
            required
          />
          <div class="invalid-feedback">Please enter a location</div>
          <div class="valid-feedback">Location looks good!</div>
        </div>

        <!-- Submit Area -->
        <div class="form-submit-area">
          <button type="submit" class="btn btn-submit-form">
            <i class="fa-solid fa-circle-plus"></i>
            Create Listing
          </button>
          <button
            type="button"
            class="btn btn-delete"
            onclick="window.location.href = '/listings'"
          >
            <i class="fa-solid fa-xmark"></i> Cancel
          </button>
        </div>
      </form>
    </div>
  </div>
</div>
<script>
  // File Upload Functionality
  const cloudUpload = document.getElementById('cloudUpload');
  const fileInput = document.getElementById('fileInput');
  const filePreview = document.getElementById('filePreview');
  const previewImage = document.getElementById('previewImage');
  const fileName = document.getElementById('fileName');
  const fileSize = document.getElementById('fileSize');

  // Drag and Drop Events
  cloudUpload.addEventListener('dragover', (e) => {
    e.preventDefault();
    cloudUpload.classList.add('drag-over');
  });

  cloudUpload.addEventListener('dragleave', () => {
    cloudUpload.classList.remove('drag-over');
  });

  cloudUpload.addEventListener('drop', (e) => {
    e.preventDefault();
    cloudUpload.classList.remove('drag-over');
    
    const files = e.dataTransfer.files;
    if (files.length > 0) {
      fileInput.files = files;
      handleFileSelect(files[0]);
    }
  });

  // File Input Change
  fileInput.addEventListener('change', (e) => {
    const file = e.target.files[0];
    if (file) {
      handleFileSelect(file);
    }
  });

  // Handle File Selection
  function handleFileSelect(file) {
    // Validate file type
    const validTypes = ['image/png', 'image/jpeg', 'image/jpg'];
    if (!validTypes.includes(file.type)) {
      alert('Please upload a valid PNG, JPG, or JPEG file');
      return;
    }

    // Validate file size (5MB max)
    const maxSize = 5 * 1024 * 1024; // 5MB in bytes
    if (file.size > maxSize) {
      alert('File size must be less than 5MB');
      return;
    }

    // Display file info
    fileName.textContent = file.name;
    fileSize.textContent = formatFileSize(file.size);

    // Preview image
    const reader = new FileReader();
    reader.onload = (e) => {
      previewImage.src = e.target.result;
      filePreview.style.display = 'flex';
    };
    reader.readAsDataURL(file);
  }

  // Remove File
  function removeFile() {
    fileInput.value = '';
    filePreview.style.display = 'none';
    previewImage.src = '';
    fileName.textContent = '';
    fileSize.textContent = '';
  }

  // Format File Size
  function formatFileSize(bytes) {
    if (bytes === 0) return '0 Bytes';
    const k = 1024;
    const sizes = ['Bytes', 'KB', 'MB', 'GB'];
    const i = Math.floor(Math.log(bytes) / Math.log(k));
    return Math.round(bytes / Math.pow(k, i) * 100) / 100 + ' ' + sizes[i];
  }
</script>
